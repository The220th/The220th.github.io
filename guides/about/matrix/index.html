<!doctype html><html lang=ru><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="СодержаниеДисклеймер Текст ниже написан дилетантом и может содержать ошибки.
Matrix Matrix - это протокол. То есть инструкция, как обмениваться сообщениями. Есть реализации этого протокола:
Клиентская часть (например, Element). Клиента реализовать легко, поэтому их много.
Серверная часть (например, Synapse). Серверную часть реализовать сложно, поэтому, реализаций серверов мало.
Список некоторых реализаций клиентов и серверов можно посмотреть тут.
Быстрые ответы на вопросы о Matirx можно найти тут.
Открытый код Протокол Matrix прозрачен, описан и доступен любому желающему."><meta name=keywords content><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://the220th.github.io/guides/about/matrix/><title>О Matrix // the220th stash</title><link rel=stylesheet href=/main.dc21861c8ce092bb3ce2c71b54de57c28a51267f03d89034169e14b80923abb3.css><meta itemprop=name content="О Matrix"><meta itemprop=description content="СодержаниеДисклеймер Текст ниже написан дилетантом и может содержать ошибки.
Matrix Matrix - это протокол. То есть инструкция, как обмениваться сообщениями. Есть реализации этого протокола:
Клиентская часть (например, Element). Клиента реализовать легко, поэтому их много.
Серверная часть (например, Synapse). Серверную часть реализовать сложно, поэтому, реализаций серверов мало.
Список некоторых реализаций клиентов и серверов можно посмотреть тут.
Быстрые ответы на вопросы о Matirx можно найти тут.
Открытый код Протокол Matrix прозрачен, описан и доступен любому желающему."><meta itemprop=datePublished content="2023-03-15T00:00:00+03:00"><meta itemprop=dateModified content="2023-03-15T00:00:00+03:00"><meta itemprop=wordCount content="1419"><meta itemprop=image content="https://the220th.github.io"><meta itemprop=keywords content><meta property="og:title" content="О Matrix"><meta property="og:description" content="СодержаниеДисклеймер Текст ниже написан дилетантом и может содержать ошибки.
Matrix Matrix - это протокол. То есть инструкция, как обмениваться сообщениями. Есть реализации этого протокола:
Клиентская часть (например, Element). Клиента реализовать легко, поэтому их много.
Серверная часть (например, Synapse). Серверную часть реализовать сложно, поэтому, реализаций серверов мало.
Список некоторых реализаций клиентов и серверов можно посмотреть тут.
Быстрые ответы на вопросы о Matirx можно найти тут.
Открытый код Протокол Matrix прозрачен, описан и доступен любому желающему."><meta property="og:type" content="article"><meta property="og:url" content="https://the220th.github.io/guides/about/matrix/"><meta property="og:image" content="https://the220th.github.io"><meta property="article:section" content="guides"><meta property="article:published_time" content="2023-03-15T00:00:00+03:00"><meta property="article:modified_time" content="2023-03-15T00:00:00+03:00"><meta property="og:site_name" content="the220th stash"><meta property="article:published_time" content="2023-03-15 00:00:00 +0300 +0300"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>the220th stash</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/guides>Гайды</a></li><li><a href=/resources>Ресурсы</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span><span class="search-icon not-selectable"><a href=/search><svg class="theme-toggler" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" id="Capa_1" width="100%" height="100%" viewBox="0 0 300 300" style="enable-background:new 0 0 310.42 310.42" sodipodi:docname="magnifier.svg" inkscape:version="1.0.2-2 (e86c870879, 2021-01-15)"><defs id="defs45"/><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1844" inkscape:window-height="1057" id="namedview43" showgrid="false" inkscape:zoom="2.027334" inkscape:cx="196.11542" inkscape:cy="182.64093" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="Capa_1"/><g id="g10" transform="matrix(-1,0,0,1,310.41981,0)"><g id="g8"><path d="m273.587 214.965c49.11-49.111 49.109-129.021.0-178.132-49.111-49.111-129.02-49.111-178.13.0C53.793 78.497 47.483 140.462 76.51 188.85c0 0 2.085 3.498-.731 6.312-16.065 16.064-64.263 64.263-64.263 64.263-12.791 12.79-15.836 30.675-4.493 42.02l1.953 1.951c11.343 11.345 29.229 8.301 42.019-4.49.0.0 48.096-48.097 64.128-64.128 2.951-2.951 6.448-.866 6.448-.866 48.387 29.026 110.352 22.717 152.016-18.947zM118.711 191.71C82.423 155.422 82.424 96.378 118.712 60.09c36.288-36.287 95.332-36.288 131.619.0 36.288 36.287 36.288 95.332.0 131.62-36.288 36.286-95.331 36.286-131.62.0z" id="path2"/><g id="g6"><path d="m126.75 118.424c-1.689.0-3.406-.332-5.061-1.031-6.611-2.798-9.704-10.426-6.906-17.038 17.586-41.559 65.703-61.062 107.261-43.476 6.611 2.798 9.704 10.426 6.906 17.038-2.799 6.612-10.425 9.703-17.039 6.906-28.354-11.998-61.186 1.309-73.183 29.663-2.099 4.959-6.913 7.938-11.978 7.938z" id="path4"/></g></g></g><g id="g12" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g14" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g16" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g18" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g20" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g22" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g24" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g26" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g28" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g30" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g32" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g34" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g36" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g38" transform="matrix(-1,0,0,1,310.41981,0)"/><g id="g40" transform="matrix(-1,0,0,1,310.41981,0)"/></svg></a></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://the220th.github.io/guides/about/matrix/>О Matrix</a></h2><hr><div class=post-content><h2>Содержание</h2><nav id=TableOfContents></nav><h1 id=дисклеймер>Дисклеймер</h1><p>Текст ниже написан дилетантом и может содержать ошибки.</p><h1 id=matrix>Matrix</h1><p><a href=https://matrix.org/><code>Matrix</code></a> - это протокол. То есть инструкция, как обмениваться сообщениями. Есть реализации этого протокола:</p><ul><li><p>Клиентская часть (например, <code>Element</code>). Клиента реализовать легко, поэтому их много.</p></li><li><p>Серверная часть (например, <code>Synapse</code>). Серверную часть реализовать сложно, поэтому, реализаций серверов мало.</p></li></ul><p>Список некоторых реализаций клиентов и серверов можно посмотреть <a href=https://matrix.org/docs/projects/try-matrix-now/>тут</a>.</p><p>Быстрые ответы на вопросы о <code>Matirx</code> можно найти <a href=https://matrix.org/faq/>тут</a>.</p><h1 id=открытый-код>Открытый код</h1><p>Протокол <code>Matrix</code> <a href=https://matrix.org/discover/>прозрачен, описан и доступен любому желающему</a>. А почти все реализованные клиенты и сервера имеют открытый код. То есть можно быть уверенным в том, что именно делает сервер во время работы <code>Matrix</code>. Также важно отметить, что <code>Matrix</code> под лицензией <a href=https://www.apache.org/licenses/LICENSE-2.0.html>Apache Licence v2</a>.</p><h1 id=организация-сообщений>Организация сообщений</h1><p>В матрице можно писать (или отправлять файлы, картинки, аудио или аудиосообщения) пользователям напрямую в лс или звонить (говорить голосом). Доступен и видеозвонок. Можно создавать и модерировать комнаты (<code>room</code>), где могут писать сразу много пользователей. Также <strong>можно</strong> сделать так, чтобы сообщения комнаты можно было читать всем по ссылке в браузере без регистрации.</p><p>В <code>Element</code> доступен групповой звонок.</p><p>Также можно организовать пространство (<code>space</code>). В пространстве можно создавать комнаты и добавлять пользователей (переписки с ними). Необязательно для этого создавать <strong>новую</strong> комнату, можно добавлять уже существующие. Также в <code>Element</code> в пространство можно добавлять другие пространства.</p><h1 id=боты>Боты</h1><p>Ботов делать легко и их много. Есть разные, нужно лишь выбрать нужного или написать своего.</p><h1 id=распределённая-архитектура-и-федерация>Распределённая архитектура и федерация</h1><p>В <code>Matrix</code> нет единого сервера. Сервера имеют распределённую архитектуру. То есть серверов много и они все связаны между собой. Связанные сервера между собой называются <code>федерацией</code>. Любой сервер может вступить в федерацию <code>Matrix</code>.</p><p>Каждый пользователь привязан к определённому серверу. Он выбирается при регистрации. Все его переписки будут храниться в зашифрованном виде на выбранном сервере. Причём сервер никак не может прочитать содержимое таких переписок, прочитать могут <strong>только</strong> участники переписки. Также организовать свой сервер <code>Matrix</code> не сверх сложно. Можно для этого приспособить не самый мощный компьютер, тем самым заимев свой личный сервер <code>Matrix</code>, который можно легко присоединить к федерации. Такой сервер называется <code>homeserver</code>. Также помимо привязки пользователей к серверу привязываются и комнаты.</p><p>Переписки синхронизируются между серверами (в одной федерации) автоматически. То есть, если есть комната <code>room_1</code> на <code>homeserver_1</code> и в неё заходит пользователь из <code>homeserver_2</code>, то <code>homeserver_2</code> автоматически получит зашифрованную (если было включено шифрование) переписку из <code>room_1</code> на <code>homeserver_1</code>. И пользователь из <code>homeserver_2</code> даже не почувствует, что он в комнате другого хомсервера. Этот пользователь может спокойно писать сообщения, а <code>homeserver_2</code> сам их синхронизирует с <code>homeserver_1</code>. Это и называется по сути федерацией.</p><p>Также <strong>можно</strong> запрещать заходить в комнаты пользователям из другого хомсервера. Ещё <strong>можно</strong> включить регистрацию на вашем хомсервере только по секретной фразе. Только те, кто её знают, смогут зарегистрироваться.</p><h1 id=групповые-комнаты>Групповые комнаты</h1><p>В <code>Matrix</code> можно создавать комнаты, где могут одновременно писать/читать много пользователей. В <code>Element</code> видно какой пользователь до какого места дочитал.</p><p>Также возможна модерация и настройка комнат. Настройка прав пользователей. Можно разрешить/запретить доступ к истории после входа в комнату.</p><h1 id=уведомления>Уведомления</h1><p>Для уведомлений (на телефон или почту) можно использовать свой собственный сервер уведомлений.</p><h1 id=мосты>Мосты</h1><p>Предположим, есть куча &ldquo;мессенджеров&rdquo; (вк, телеграмм, ватсапп, skype и прочее всякое) или электронная почта. Тогда нужно устанавливать куча клиентов (приложений), чтобы этим пользоваться. А память того же телефона не резиновая. В <code>Matrix</code> есть такое понятие, как <code>мосты</code>, они позволяют соединить все эти &ldquo;мессенджеры&rdquo; через матрицу&mldr;</p><p>То есть условный пользователь пишет вам в чате, например, телеграмма. Вы видите это сообщение в матрице и отвечаете в матрице, а ему показывается это сообщение так, как будто вы ответили ему в телеграмме. Работает и с групповыми чатами.</p><p><a href=https://habr.com/ru/company/reactos/blog/599777/>Статья про опыт использования мостов в Telegram и Discord.</a></p><h1 id=кроссплатформенность>Кроссплатформенность</h1><p>Зависит от клиента, но, например, <code>Element</code> доступен на всех платформах: GNU/Linux, Android, Windows, Mac&mldr;</p><p>Есть статья с обзором <a href=https://habr.com/ru/post/665766/><code>Element</code></a>.</p><p>Также <code>Matrix</code> можно пользоваться из браузера. Необязательно устанавливать какие-либо клиенты на устройство.</p><h1 id=регистрация>Регистрация</h1><p>Для регистрации в матрице не нужно чего-либо, кроме логина и пароля. Потеря пароля означает потерю аккаунта. Но некоторые сервера федерации <code>Matrix</code> позволяют привязывать почту, номер телефона, делать двухфакторную аутентификацию и т. п. Тогда будет возможность восстановить аккаунт в случае потери пароля. Но это опционально и нужно явным образом это всё включать в настройках аккаунта. Также некоторые хомсерверы поддерживают авторизацию (регистрацию) через сторонние сервисы: гугл, гитхаб и т. п.</p><p>На самом деле хомсервер способен восстановить аккаунт в случае потери пароля, но тогда все переписки будет расшифровать невозможно, а владельцу и пользователям по переписке будет извещено, что с вашим аккаунтом что-то не так, он (аккаунт) будет помечен как <code>неверифицированный</code> (красный) для них.</p><p>Также на хомсерверах можно включить регистрацию только тем, кто знает секретную фразу. Или же можно регистрацию отключить вовсе, и тогда регистрировать каждого пользователя будет администратор хомсервера вручную.</p><h1 id=аутентификация>Аутентификация</h1><p>В <code>Matrix</code> продуманная система аутентификации. Предположим 2 вполне реальные ситуации.</p><p>В первой ситуации <code>User</code> уже авторизирован на клиенте с компьютера. Теперь <code>User</code> зашёл и, например, с телефона. Тогда в любой верифицированной сессии <code>User</code> покажется уведомление с просьбой подтвердить аутентификацию. Нужно пройти некоторые челленджи, и после этого сессия с телефона будет верифицированной. Она сможет расшифровать старые переписки и отсылать сообщения контактам без каких либо проблем.</p><p>Во второй ситуации <code>User1</code> общается с <code>User2</code>. Но <code>User2</code> сделал себе пароль &ldquo;ilovesleep&rdquo; и его, конечно, взломали. Теперь <code>User2</code> для <code>User1</code> выглядит как 2 разные сессии: верифицированная (зелёная) и ещё какая-то (красная). В случае, если красная сессия напишет <code>User1</code> сообщение, то:</p><ul><li><p><code>User1</code> увидит, что написала ему неверифицированния (красная) сессия. В настройках такие сессии можно блокировать автоматически.</p></li><li><p>Красная сессия <code>User2</code> будет красной до тех пор, пока <code>User2</code> не верифицирует её (как в первом случае) или пока <code>User1</code> сам не нажмёт кнопку верифицировать красную сессию <code>User2</code>.</p></li><li><p>Красная сессия <code>User2</code> не сможет расшифровать старые переписки до тех пор, пока она не станет зелёной (математика не позволит).</p></li></ul><p>На самом деле верифицировать сессию необязательно с другого верифицированного аккаунта. Можно это делать и с помощью фразы восстановления аккаунта. С помощью этой фразы можно получить ключи шифрования и ключи аутентификации, тем самым сделать сессию зелёной сразу. Такая фраза восстановления выдаётся при регистрации или при сбросе аккаунта.</p><p>Сброс аккаунта - это процесс обновления ключей шифрования и ключей авторизации (это очень неточное определение). В этом случае доступ к старым перепискам будет невозможен, а аккаунт станет красным.</p><p>Сбросить аккаунт может и красная сессия, тогда все зелёные сессии станут красными. В этом случае восстановление аккаунта дело трудоёмкое, но возможное.</p><p>Если доступ к аккаунту утерян, то восстановление аккаунта возможно на хомсервере. Так как хомсервер не имеет возможности получить ваши ключи, то восстановленная сессия будет красной. Доступ к старым перепискам будет невозможен. Зелёной её сделать может только сам владелец аккаунта, если у него есть фраза восстановления или доступ к зелёной сессии.</p><h1 id=портативно>Портативно</h1><p><code>Element</code> сохраняет также ваши зашифрованные переписки и локально (оффлайн) на устройстве, причём только в одной папке.</p><p>Но важно ещё раз отметить, что переписки в зашифрованном виде лежат в <code>homeserver</code>.</p><p>В <code>Element</code> можно использовать сразу несколько аккаунтов, у каждого будет своя отдельная папка, которую можно носить с собой.</p><h1 id=шифрование>Шифрование</h1><p>В <code>Matrix</code> для генерации и подписи ключей используются <code>эллиптическая кривая 25519</code>, <code>ECDH</code>, <code>HKDF-SHA-256</code> и <code>AES-256</code>. Каждый device имеет <code>Ed25519 fingerprint key pair</code>, с помощью которых можно идентифицировать этот device. Для обмена общим секретом (например, ключом) используется <code>Curve25519</code> (только одна инициализация только для одного обмена). Ключи для шифрования алгоритмом <code>AES-256</code> получаются с помощью <code>HKDF-SHA-256</code>. Сам обмен ключами происходит протоколом Диффи-Хеллмана-Меркла на эллиптических кривых (<code>ECDH</code>). Подробнее <a href=https://matrix.org/docs/guides/end-to-end-encryption-implementation-guide>тут</a>.</p><p>Для <code>Matrix</code> была разработана имплементация <a href=https://signal.org/docs/specifications/doubleratchet/>алгоритма двойного храповника</a>. Называется <a href=https://gitlab.matrix.org/matrix-org/olm/-/blob/master/docs/olm.md>olm</a>.</p><p>Благодаря <code>olm</code>, если ваш аккаунт был скомпрометирован, то злоумышленник сможет прочитать лишь часть сообщений (или одно в зависимости от настроек). Не получится ему прочитать самые первые переписки или последующие. Блок сообщений шифруется разными ключами, которые обновляются и получаются с помощью алгоритма двойного храповника. Ключи могут меняться после захода/выхода в/из комнаты, после истечения определённого времени или после использования ключа N раз. Но проблема заключается в том, что алгоритм подразумевает, что сообщения передаются только между двумя лицами. В групповых чатах использовать <code>olm</code> проблематично.</p><p>Поэтому <code>olm</code> был &ldquo;модифицирован&rdquo; в <a href=https://gitlab.matrix.org/matrix-org/olm/-/blob/master/docs/megolm.md>megolm</a>. <code>Megolm</code> как раз решает проблему передачи сообщений в групповых чатах. Поэтому в <code>Matrix</code> используется именно <code>megolm</code>. Даже в &ldquo;одиночных чатах&rdquo;, так как эти &ldquo;чаты&rdquo; могут быть расширены до комнаты. Нужно отметить, что никакое шифрование не спасёт, если в комнате много людей, тем более если комната общедоступная. Поэтому в общедоступных комнатах нужно несколько раз подумать, прежде чем включать шифрование, так как это скажется на производительности.</p><p>Передача сообщений, их хранение на сервере, обмен ключами подразумевает, что <code>homeserver</code> относится к разряду <code>untrusted</code>. То есть думается, что сервер (как и все остальные) пытается всяким образом &ldquo;взломать&rdquo; ваши переписки. Отсюда такие сложности. Но пользователь используя <code>Matrix</code> даже не заметит их (ну почти), но знать об этом надо.</p><p>Аудиозвонки происходят через <code>WebRTC</code>, а через <code>Matrix</code> отсылается лишь событие и служебная информация об организации такого звонка.</p><h1 id=заключение>Заключение</h1><p>Приятно, когда <strong>вашими личными</strong> переписками не надо делиться с третьими лицами, которые никакого отношения не имеют к <strong>вашим личным</strong> сообщениям.</p></div></article><hr><div class=post-info><p><span> The220th</span></p><p> 15 Марта, 2023 г.</p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2023</span>
<span><a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></span></div></div><div class=footer__inner><div class=footer__content><span><a href=https://github.com/rhazdon/hugo-theme-hello-friend-ng>Hello Friend NG</a></span><span><a href=http://gohugo.io>Hugo</a></span></div></div></footer></div><script language=javascript type=text/javascript src=https://the220th.github.io/js/main.js></script>
<script defer language=javascript type=text/javascript src=https://the220th.github.io/js/menu.js></script>
<script defer language=javascript type=text/javascript src=https://the220th.github.io/js/backtotop.js></script></body></html>